<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>modgen minetest mod</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>modgen</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Chunk_manifest">Chunk manifest </a></li>
<li><a href="#Export_versions">Export versions </a></li>
</ul>


<h2>Topics</h2>
<ul class="">
  <li><strong>readme</strong></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/autosave.html">autosave</a></li>
  <li><a href="../modules/chunk.html">chunk</a></li>
  <li><a href="../modules/export.html">export</a></li>
  <li><a href="../modules/functions.html">functions</a></li>
  <li><a href="../modules/import_mod.html">import_mod</a></li>
  <li><a href="../modules/manifest.html">manifest</a></li>
  <li><a href="../modules/serialize.html">serialize</a></li>
</ul>

</div>

<div id="content">


<p>modgen mod for minetest</p>

<p><img src="https://github.com/BuckarooBanzay/modgen/workflows/luacheck/badge.svg" alt=""/>
<img src="https://github.com/BuckarooBanzay/modgen/workflows/test/badge.svg" alt=""/>
<img src="https://github.com/BuckarooBanzay/modgen/workflows/busted/badge.svg" alt=""/>
<a href="license.txt"><img src="https://img.shields.io/badge/License-MIT%20and%20CC%20BY--SA%203.0-green.svg" alt="License"/></a>
<a href="https://content.minetest.net/packages/BuckarooBanzay/modgen"><img src="https://img.shields.io/badge/Download-ContentDB-blue.svg" alt="Download"/></a></p>

<h1>Overview</h1>

<p>Allows you to export a part of the map as a standalone mod which can be used as a mapgen</p>

<p>Api docs: https://buckaroobanzay.github.io/modgen/</p>

<p>Demo: https://github.com/BuckarooBanzay/mesecons_lab</p>

<p><img src="./screenshot.png" alt="Screenshot"/></p>

<h1>Commands</h1>

<ul>
    <li><code>/pos1</code>, <code>/pos2</code> Set opposite corners of the export map</li>
    <li><code>/export [fast]</code> Exports the map as a standalone mod into <code>${worldfolder}/modgen_mod_export</code></li>
    <li><code>/modgen_stats</code> Returns some stats about the exported chunks and size</li>
    <li><code>/autosave [on|off]</code> enables autosave feature (<strong>warning</strong>: may not work on some worldedit commands)</li>
</ul>

<h1>In-place saving</h1>

<p>After an initial mod-export the resulting mod can be edited live and in-place
if the <code>modgen</code> mod is also present (optional).</p>

<p>To enable the saving directly into the exported mod you have to add it to the "trusted_mods" setting:</p>

<pre><code> secure.trusted_mods = modgen
</code></pre>


<p>Afterwards if you mark a region and execute <code>/export</code> the chunks are written to the exported mod itself</p>

<h1>Chunk export format</h1>

<p>Chunks saved in <code>${import_mod}/map/chunk_${x}_${y}_${z}.bin</code></p>
<pre><code> 1 byte:                       serialization version
 1 byte:                       number of mapblocks in this chunk (#mapblocks)
 4 bytes:                      modification time of this chunk
 4096 * 2 * #mapblocks bytes:  node_ids of the mapblocks in (4096 * uint16) portions
 4096 * #mapblocks bytes:      param1 data of the mapblocks
 4096 * #mapblocks bytes:      param2 data of the mapblocks
 remaining bytes:              chunk manifest in json format
</code></pre>


<p><a name="Chunk_manifest"></a></p>
<h2>Chunk manifest</h2>

<p>Json-file in the following format:</p>

<pre>
{
  <span class="string">"mapblocks"</span>: [{
    <span class="string">"pos"</span>: {
      <span class="string">"x"</span>: <span class="number">10</span>,
      <span class="string">"y"</span>: -<span class="number">1</span>,
      <span class="string">"z"</span>: <span class="number">4</span>
    },
    <span class="string">"has_metadata"</span>: <span class="keyword">true</span>,
    <span class="string">"metadata"</span>: {
      <span class="string">"meta"</span>: {},
      <span class="string">"timers"</span>: {}
    }
  }],
  <span class="string">"mtime"</span>: <span class="number">1649956501</span>
}
</pre>


<p><strong>NOTE</strong>: the <code>mapblocks[].pos</code> field references absolute world-positions in mapblocks</p>

<h1>Global manifest</h1>

<p>Saved in <code>${import_mod}/manifest.json</code></p>

<p>Json file that serves as an index to look up global infos:
* Amount of chunks and bytes saved
* Last modification time
* Node-ID mapping
* Max- and min-bounds of the chunks saved
* Modgen version used to save this map
* UID of the map (gets saved in the mod_storage of the world to prevent mod-misplacement)</p>


<pre>
{
  <span class="string">"chunks"</span> : <span class="number">17</span>,
  <span class="string">"mtime"</span> : <span class="number">1649956501</span>,
  <span class="string">"next_id"</span>: <span class="number">82</span>,
  <span class="string">"node_mapping"</span>: {
    <span class="string">"access_cards:palm_scanner_off"</span>: <span class="number">25</span>,
    <span class="string">"air"</span>: <span class="number">0</span>,
    <span class="string">"default:chest"</span>: <span class="number">53</span>,
    <span class="string">"digilines:wire_std_00100000"</span>: <span class="number">72</span>
  },
  <span class="string">"bounds"</span>: {
    <span class="string">"min"</span>: {
      <span class="string">"x"</span>: <span class="number">0</span>,
      <span class="string">"y"</span>: <span class="number">0</span>,
      <span class="string">"z"</span>: <span class="number">0</span>
    },
    <span class="string">"max"</span>: {
      <span class="string">"x"</span>: <span class="number">0</span>,
      <span class="string">"y"</span>: <span class="number">0</span>,
      <span class="string">"z"</span>: <span class="number">0</span>
    }
  },
  <span class="string">"size"</span> : <span class="number">184548</span>,
  <span class="string">"uid"</span> : <span class="string">"970683"</span>,
  <span class="string">"version"</span> : <span class="number">3</span>
}
</pre>


<p><a name="Export_versions"></a></p>
<h2>Export versions</h2>

<p>Major versions with breaking changes:</p>

<ul>
    <li>Version <code>1</code>: Initial release</li>
    <li>Version <code>2</code>: Reordered export axes from <code>z-x-y</code> to <code>z-x-y</code> (30% size decrease)</li>
    <li>Version <code>3</code>: Export whole chunks (50% size decrease)</li>
    <li>Version <code>4</code>: Manifest with easy accessible mtime info</li>
</ul>

<p>To migrate between the major versions export everything into the world and re-import with the new version</p>

<h1>Testing</h1>

<p>Requirements:
* Docker
* docker-compose</p>

<p>Usage:</p>

<pre>
docker-compose up <span class="comment">--build</span>
</pre>


<h1>License</h1>

<ul>
    <li>Code: MIT</li>
    <li>Textures: CC-BY-SA 3.0 (http://www.small-icons.com/packs/16x16-free-application-icons.htm)</li>
</ul>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2022-04-20 17:43:46 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
